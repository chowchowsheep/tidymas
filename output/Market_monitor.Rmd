---
title: "Market Monitor"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(Rblpapi)
library(DT)

blpConnect()

getData <- function(ticker){
  bdh(ticker, c("PX_LAST"), start.date = Sys.Date()-365)
}

chart_subtitle <- function(data){
  paste("Last done: ", format(data$PX_LAST[length(data$PX_LAST)], big.mark = ","),
        " Change: ", format(round(data$PX_LAST[length(data$PX_LAST)] - data$PX_LAST[length(data$PX_LAST) - 1], 3), big.mark = ","),
        " Low: ", format(min(data$PX_LAST), big.mark = ","),
        " High: ", format(max(data$PX_LAST), big.mark = ",")
        )
}

ggTS <- function(ticker, title = ticker){
  data <- getData(ticker = ticker)

  ggplot2::ggplot(data, ggplot2::aes(x = date, y = PX_LAST)) +
    ggplot2::geom_line(colour = "navyblue") +
    ggplot2::labs(title = title, subtitle = chart_subtitle(data = data), y = "Price", x = "Date")

}

```

## Rates
```{r rates, echo=FALSE}
# datatable(head(mtcars), options = list(dom = 't'))

ggTS("GTDEM10Y Govt", title = "German Govt 10Y")
ggTS("DEYC2Y10 Index", title = "German Sell 2Y Buy 10Y")
ggTS("DEYC1030 Index", title = "German Sell 10Y Buy 30Y")
ggTS("GTGBP10Y Govt", title = "UK Govt 10Y")
```

## FX 
```{r FX, echo=FALSE}
ggTS("EURUSD Curncy")
ggTS("GBPUSD Curncy")
ggTS("GBPEUR Curncy")
ggTS("DXY Index", title = "US Dollar Index")
```

##Equities
All charts are price return (instead of total returns).

```{r equities, echo=FALSE}
ggTS("SPX Index")
ggTS("INDU Index", title = "Dow Jones Industrial Average")
ggTS("CCMP Index", title = "NASDAQ Composite Index")
ggTS("SX5E Index", title = "EuroStoxx 50")
```

##Commodities

```{r commodities, echo=FALSE}
ggTS("XAU Curncy", title = "Spot Gold")
ggTS("CO1 Comdty", title = "Brent generic 1st contract")
ggTS("XBTUSD COIN Curncy", title = "BitCoin")

```

##Team positions
```{r team_pos, echo=FALSE}
#TODO Add team positions
```
